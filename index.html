<!DOCTYPE html>
<html lang="en">
<head>
Â  Â  <meta charset="UTF-8">
Â  Â  <meta name="viewport" content="width=device-width, initial-scale=1.0">
Â  Â  <title>SW London Weather</title>
Â  Â  <script src="https://cdn.tailwindcss.com"></script>
Â  Â  <style>
Â  Â  Â  Â  /* Import the standard font */
Â  Â  Â  Â  @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap');
Â  Â  Â  Â Â 
Â  Â  Â  Â  /* Import the Noto Color Emoji font for older device compatibility */
Â  Â  Â  Â  @import url('https://fonts.googleapis.com/css2?family=Noto+Color+Emoji&display=swap');Â 

Â  Â  Â  Â  body {
Â  Â  Â  Â  Â  Â  font-family: 'Inter', sans-serif;
Â  Â  Â  Â  Â  Â  /* Force black background and white text via inline CSS, in case Tailwind fails */
Â  Â  Â  Â  Â  Â  background-color: #000 !important;
Â  Â  Â  Â  Â  Â  color: white !important;
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  flex-direction: column;
Â  Â  Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  Â  Â  justify-content: center;
Â  Â  Â  Â  Â  Â  min-height: 100vh;
Â  Â  Â  Â  Â  Â  text-align: center;
Â  Â  Â  Â  }

Â  Â  Â  Â  /* Apply the emoji font to the element containing emojis */
Â  Â  Â  Â  .emoji-fallback {
Â  Â  Â  Â  Â  Â  font-family: 'Noto Color Emoji', 'Inter', sans-serif;
Â  Â  Â  Â  }

Â  Â  Â  Â  /* Custom class to ensure main text is white and a consistent size on small screens */
Â  Â  Â  Â  .main-text {
Â  Â  Â  Â  Â  Â  color: white !important;
Â  Â  Â  Â  Â  Â  font-size: 1.875rem;
Â  Â  Â  Â  Â  Â  line-height: 2.25rem;
Â  Â  Â  Â  }
Â  Â  </style>
</head>
<body class="bg-black text-white"> 
Â  Â  <div>
Â  Â  Â  Â  <div id="weather-display" class="flex flex-col items-center justify-center emoji-fallback">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-white">Checking weather for journey to LMS...</p> 
Â  Â  Â  Â  Â  Â  <br>
Â  Â  Â  Â  Â  Â  <p class="text-white"> ğŸš¶ğŸ¼â€â™€ï¸â€â¡ï¸ ğŸšƒ ğŸš¶ğŸ¼â€â™€ï¸â€â¡ï¸ ğŸ§¥ â˜‚ï¸ ? </p>Â 
Â  Â  Â  Â  </div>
Â  Â  </div>

Â  Â  <script>
Â  Â  Â  Â  document.addEventListener('DOMContentLoaded', () => {
Â  Â  Â  Â  Â  Â  const displayElement = document.getElementById('weather-display');

Â  Â  Â  Â  Â  Â  // IMPORTANT: This URL must be from the most recent deployment of your Apps Script
Â  Â  Â  Â  Â  Â  const GAS_WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbyqNZJhOOMDtFwgB5EWaoUuewSijG_DvWB3a015qSshCUsTDAhVaMSlv3jGtc6kKeGMoQ/exec';
Â  Â  Â  Â  Â  Â  const LAT = 51.42;
Â  Â  Â  Â  Â  Â  const LON = -0.22;
Â  Â  Â  Â  Â  Â  const apiUrl = `${GAS_WEB_APP_URL}`;

Â  Â  Â  Â  Â  Â  if (GAS_WEB_APP_URL === 'YOUR_NEWLY_DEPLOYED_APPS_SCRIPT_URL_HERE') {
Â  Â  Â  Â  Â  Â  Â  Â  displayElement.innerHTML = `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-red-500">Error: Google Apps Script URL not set.</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-sm mt-2">Please edit this file and replace 'YOUR_NEWLY_DEPLOYED_APPS_SCRIPT_URL_HERE' with your deployed web app URL.</p>
Â  Â  Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  // Helper function to get a weather emoji from a WMO code
Â  Â  Â  Â  Â  Â  const wmoWeatherCodeToEmoji = (code, isDay) => {
Â  Â  Â  Â  Â  Â  Â  Â  const isNight = isDay === 0;
Â  Â  Â  Â  Â  Â  Â  Â  const emojis = {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  0: isNight ? "ğŸŒ™" : "â˜€ï¸",
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  1: isNight ? "â˜ï¸ğŸŒ™" : "ğŸŒ¤ï¸",
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  2: isNight ? "â˜ï¸ğŸŒ™" : "â›…ï¸",
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  3: "â˜ï¸",
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  45: "ğŸŒ«ï¸", 48: "ğŸŒ«ï¸",
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  51: "ğŸŒ¦ï¸", 53: "ğŸŒ§ï¸", 55: "ğŸŒ§ï¸", 56: "ğŸ¥¶ğŸŒ§ï¸", 57: "ğŸ¥¶ğŸŒ§ï¸",
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  61: "ğŸŒ§ï¸", 63: "ğŸŒ§ï¸", 65: "ğŸŒ§ï¸", 66: "ğŸ¥¶ğŸŒ§ï¸", 67: "ğŸ¥¶ğŸŒ§ï¸",
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  71: "ğŸŒ¨ï¸", 73: "ğŸŒ¨ï¸", 75: "ğŸŒ¨ï¸", 77: "ğŸŒ¨ï¸",
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  80: "ğŸŒ§ï¸", 81: "ğŸŒ§ï¸", 82: "ğŸŒ§ï¸", 85: "ğŸŒ¨ï¸", 86: "ğŸŒ¨ï¸",
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  95: "â›ˆï¸", 96: "â›ˆï¸", 99: "â›ˆï¸"
Â  Â  Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  Â  Â  Â  return emojis[code] || "â“";
Â  Â  Â  Â  Â  Â  };

Â  Â  Â  Â  Â  Â  // Helper function to get weather description from WMO code
Â  Â  Â  Â  Â  Â  const getWeatherDescription = (code) => {
Â  Â  Â  Â  Â  Â  Â  Â  const descriptions = {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  0: "Clear sky", 1: "Mainly clear", 2: "Partly cloudy", 3: "Overcast",
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  45: "Fog", 48: "Depositing rime fog",
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  51: "Light drizzle", 53: "Moderate drizzle", 55: "Dense drizzle",
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  56: "Light freezing drizzle", 57: "Dense freezing drizzle",
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  61: "Light rain", 63: "Moderate rain", 65: "Heavy rain",
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  66: "Light freezing rain", 67: "Heavy freezing rain",
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  71: "Light snow fall", 73: "Moderate snow fall", 75: "Heavy snow fall",
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  77: "Snow grains",
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  80: "Light rain showers", 81: "Moderate rain showers", 82: "Violent rain showers",
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  85: "Light snow", 86: "Heavy snow",
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  95: "Thunderstorm", 96: "Thunderstorm with hail", 99: "Thunderstorm with heavy hail"
Â  Â  Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  Â  Â  Â  return descriptions[code] || "Unknown weather";
Â  Â  Â  Â  Â  Â  };

Â  Â  Â  Â  Â  Â  fetch(apiUrl)
Â  Â  Â  Â  Â  Â  Â  Â  .then(response => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!response.ok) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  throw new Error(`Network response was not ok: ${response.statusText}`);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return response.json();
Â  Â  Â  Â  Â  Â  Â  Â  })
Â  Â  Â  Â  Â  Â  Â  Â  .then(data => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (data && data.daily && data.hourly) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Extract daily data for overall forecast
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const dailyWeatherCode = data.daily.weather_code[1];
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const dailyMaxTemp = data.daily.temperature_2m_max[1].toFixed(0);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const dailyMinTemp = data.daily.temperature_2m_min[1].toFixed(0);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const dailyDescription = getWeatherDescription(dailyWeatherCode);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Extract yesterday's high temperature from the daily array at index 0
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const yesterdayMaxTemp = data.daily.temperature_2m_max[0].toFixed(0);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Calculate the temperature difference
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const tempDiff = dailyMaxTemp - yesterdayMaxTemp;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Logic for "warmer" / "cooler"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const diffText = tempDiff > 0 ? `${Math.abs(tempDiff)}Â°C warmer than yesterday` :
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â tempDiff < 0 ? `${Math.abs(tempDiff)}Â°C cooler than yesterday` :
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â `Similar temperature as yesterday`;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Use current data for day/night
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const isDay = data.current.is_day;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const dailyWeatherEmoji = wmoWeatherCodeToEmoji(dailyWeatherCode, isDay);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Extract hourly data for the 2-hour rain forecast
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const rainProbabilities = data.hourly.precipitation_probability.slice(0, 2);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const maxRainProbability = Math.max(...rainProbabilities);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Updated display template
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  displayElement.innerHTML = `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-7xl leading-none">${dailyWeatherEmoji}</p>Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex flex-col items-center justify-center">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="main-text capitalize mt-2">${dailyDescription}</p>Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-xl mt-2">High <span class="text-white">${dailyMaxTemp}</span>Â°C / Low <span class="text-white">${dailyMinTemp}</span>Â°C</p>Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-xl font-bold">${diffText}</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <br>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-xl mt-2">ğŸŒ§ï¸ <span class="text-white">${maxRainProbability}</span>% chance of rain within 2 hrs</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Send the 'page-ready' signal to the parent window
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  window.parent.postMessage({ type: 'page-ready' }, '*');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â <!DOCTYPE html>
<html lang="en">
<head>
Â  Â  <meta charset="UTF-8">
Â  Â  <meta name="viewport" content="width=device-width, initial-scale=1.0">
Â  Â  <title>SW London Weather</title>
Â  Â  <script src="https://cdn.tailwindcss.com"></script>
Â  Â  <style>
Â  Â  Â  Â  /* Import the standard font */
Â  Â  Â  Â  @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap');
Â  Â  Â  Â Â 
Â  Â  Â  Â  /* Import the Noto Color Emoji font for older device compatibility */
Â  Â  Â  Â  @import url('https://fonts.googleapis.com/css2?family=Noto+Color+Emoji&display=swap');Â 

Â  Â  Â  Â  body {
Â  Â  Â  Â  Â  Â  font-family: 'Inter', sans-serif;
Â  Â  Â  Â  Â  Â  /* ENFORCED FIX: Ensure background is black and text is white */
Â  Â  Â  Â  Â  Â  background-color: #000 !important;
Â  Â  Â  Â  Â  Â  color: white !important;
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  flex-direction: column;
Â  Â  Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  Â  Â  justify-content: center;
Â  Â  Â  Â  Â  Â  min-height: 100vh;
Â  Â  Â  Â  Â  Â  text-align: center;
Â  Â  Â  Â  }

Â  Â  Â  Â  /* Apply the emoji font to the element containing emojis */
Â  Â  Â  Â  .emoji-fallback {
Â  Â  Â  Â  Â  Â  font-family: 'Noto Color Emoji', 'Inter', sans-serif;
Â  Â  Â  Â  }

Â  Â  Â  Â  /* Custom class for the main weather description text size/color */
Â  Â  Â  Â  .main-text {
Â  Â  Â  Â  Â  Â  color: white !important;
Â  Â  Â  Â  Â  Â  font-size: 1.875rem; /* text-3xl */
Â  Â  Â  Â  Â  Â  line-height: 2.25rem;
Â  Â  Â  Â  }
Â  Â  </style>
</head>
<body class="bg-black text-white">
Â  Â  <div>
Â  Â  Â  Â  <div id="weather-display" class="flex flex-col items-center justify-center emoji-fallback">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-white">Checking weather for journey to LMS...</p>
Â  Â  Â  Â  Â  Â  <br>
Â  Â  Â  Â  Â  Â  <p class="text-white"> ğŸš¶ğŸ¼â€â™€ï¸â€â¡ï¸ ğŸšƒ ğŸš¶ğŸ¼â€â™€ï¸â€â¡ï¸Â  Â  Â  ğŸ§¥Â  Â  Â  â˜‚ï¸Â  Â  Â  ? </p>Â 
Â  Â  Â  Â  </div>
Â  Â  </div>

Â  Â  <script>
Â  Â  Â  Â  document.addEventListener('DOMContentLoaded', () => {
Â  Â  Â  Â  Â  Â  const displayElement = document.getElementById('weather-display');

Â  Â  Â  Â  Â  Â  // IMPORTANT: This URL must be from the most recent deployment of your Apps Script
Â  Â  Â  Â  Â  Â  const GAS_WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbyqNZJhOOMDtFwgB5EWaoUuewSijG_DvWB3a015qSshCUsTDAhVaMSlv3jGtc6kKeGMoQ/exec';
Â  Â  Â  Â  Â  Â  const LAT = 51.42;
Â  Â  Â  Â  Â  Â  const LON = -0.22;
Â  Â  Â  Â  Â  Â  const apiUrl = `${GAS_WEB_APP_URL}`;

Â  Â  Â  Â  Â  Â  if (GAS_WEB_APP_URL === 'YOUR_NEWLY_DEPLOYED_APPS_SCRIPT_URL_HERE') {
Â  Â  Â  Â  Â  Â  Â  Â  displayElement.innerHTML = `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-red-500">Error: Google Apps Script URL not set.</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-sm mt-2">Please edit this file and replace 'YOUR_NEWLY_DEPLOYED_APPS_SCRIPT_URL_HERE' with your deployed web app URL.</p>
Â  Â  Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  // Helper function to get a weather emoji from a WMO code
Â  Â  Â  Â  Â  Â  const wmoWeatherCodeToEmoji = (code, isDay) => {
Â  Â  Â  Â  Â  Â  Â  Â  const isNight = isDay === 0;
Â  Â  Â  Â  Â  Â  Â  Â  const emojis = {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  0: isNight ? "ğŸŒ™" : "â˜€ï¸",
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  1: isNight ? "â˜ï¸ğŸŒ™" : "ğŸŒ¤ï¸",
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  2: isNight ? "â˜ï¸ğŸŒ™" : "â›…ï¸",
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  3: "â˜ï¸",
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  45: "ğŸŒ«ï¸", 48: "ğŸŒ«ï¸",
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  51: "ğŸŒ¦ï¸", 53: "ğŸŒ§ï¸", 55: "ğŸŒ§ï¸", 56: "ğŸ¥¶ğŸŒ§ï¸", 57: "ğŸ¥¶ğŸŒ§ï¸",
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  61: "ğŸŒ§ï¸", 63: "ğŸŒ§ï¸", 65: "ğŸŒ§ï¸", 66: "ğŸ¥¶ğŸŒ§ï¸", 67: "ğŸ¥¶ğŸŒ§ï¸",
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  71: "ğŸŒ¨ï¸", 73: "ğŸŒ¨ï¸", 75: "ğŸŒ¨ï¸", 77: "ğŸŒ¨ï¸",
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  80: "ğŸŒ§ï¸", 81: "ğŸŒ§ï¸", 82: "ğŸŒ§ï¸", 85: "ğŸŒ¨ï¸", 86: "ğŸŒ¨ï¸",
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  95: "â›ˆï¸", 96: "â›ˆï¸", 99: "â›ˆï¸"
Â  Â  Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  Â  Â  Â  return emojis[code] || "â“";
Â  Â  Â  Â  Â  Â  };

Â  Â  Â  Â  Â  Â  // Helper function to get weather description from WMO code
Â  Â  Â  Â  Â  Â  const getWeatherDescription = (code) => {
Â  Â  Â  Â  Â  Â  Â  Â  const descriptions = {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  0: "Clear sky", 1: "Mainly clear", 2: "Partly cloudy", 3: "Overcast",
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  45: "Fog", 48: "Depositing rime fog",
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  51: "Light drizzle", 53: "Moderate drizzle", 55: "Dense drizzle",
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  56: "Light freezing drizzle", 57: "Dense freezing drizzle",
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  61: "Light rain", 63: "Moderate rain", 65: "Heavy rain",
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  66: "Light freezing rain", 67: "Heavy freezing rain",
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  71: "Light snow fall", 73: "Moderate snow fall", 75: "Heavy snow fall",
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  77: "Snow grains",
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  80: "Light rain showers", 81: "Moderate rain showers", 82: "Violent rain showers",
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  85: "Light snow", 86: "Heavy snow",
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  95: "Thunderstorm", 96: "Thunderstorm with hail", 99: "Thunderstorm with heavy hail"
Â  Â  Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  Â  Â  Â  return descriptions[code] || "Unknown weather";
Â  Â  Â  Â  Â  Â  };

Â  Â  Â  Â  Â  Â  fetch(apiUrl)
Â  Â  Â  Â  Â  Â  Â  Â  .then(response => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!response.ok) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  throw new Error(`Network response was not ok: ${response.statusText}`);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return response.json();
Â  Â  Â  Â  Â  Â  Â  Â  })
Â  Â  Â  Â  Â  Â  Â  Â  .then(data => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (data && data.daily && data.hourly) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Extract daily data for overall forecast
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const dailyWeatherCode = data.daily.weather_code[1];
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const dailyMaxTemp = data.daily.temperature_2m_max[1].toFixed(0);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const dailyMinTemp = data.daily.temperature_2m_min[1].toFixed(0);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const dailyDescription = getWeatherDescription(dailyWeatherCode);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Extract yesterday's high temperature from the daily array at index 0
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const yesterdayMaxTemp = data.daily.temperature_2m_max[0].toFixed(0);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Calculate the temperature difference
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const tempDiff = dailyMaxTemp - yesterdayMaxTemp;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const diffText = tempDiff > 0 ? `${Math.abs(tempDiff)}Â°C warmer than yesterday` :
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â tempDiff < 0 ? `${Math.abs(tempDiff)}Â°C cooler than yesterday` :
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â `Similar temperature as yesterday`;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Use current data for day/night
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const isDay = data.current.is_day;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Using a smaller emoji size (text-7xl) from the previous attempt to match the original image
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const dailyWeatherEmoji = wmoWeatherCodeToEmoji(dailyWeatherCode, isDay);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Extract hourly data for the 2-hour rain forecast
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const rainProbabilities = data.hourly.precipitation_probability.slice(0, 2);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const maxRainProbability = Math.max(...rainProbabilities);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // FIXES: Applying classes to ensure text is the correct size/color and correcting spacing for numbers.
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  displayElement.innerHTML = `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-7xl leading-none">${dailyWeatherEmoji}</p>Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex flex-col items-center justify-center">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="main-text capitalize mt-2">${dailyDescription}</p>Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-xl mt-2">High <span class="text-white">${dailyMaxTemp}</span>Â°C / Low <span class="text-white">${dailyMinTemp}</span>Â°C</p>Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-xl font-bold">${diffText}</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <br>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-xl mt-2">ğŸŒ§ï¸ <span class="text-white">${maxRainProbability}</span>% chance of rain within 2 hrs</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Send the 'page-ready' signal to the parent window
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  window.parent.postMessage({ type: 'page-ready' }, '*');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  displayElement.innerHTML = '<p class="text-red-500">No weather data found. Data may be incomplete.</p>';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  })
Â  Â  Â  Â  Â  Â  Â  Â  .catch(error => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.error('Fetch error:', error);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  displayElement.innerHTML = `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-red-500">Failed to load weather data.</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-sm mt-2">Please check your Google Apps Script URL and deployment status.</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  });
Â  Â  </script>
</body>
</html>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  displayElement.innerHTML = '<p class="text-red-500">No weather data found. Data may be incomplete.</p>';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  })
Â  Â  Â  Â  Â  Â  Â  Â  .catch(error => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.error('Fetch error:', error);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  displayElement.innerHTML = `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-red-500">Failed to load weather data.</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-sm mt-2">Please check your Google Apps Script URL and deployment status.</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  });
Â  Â  </script>
</body>
</html>
